<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Smell Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h1>Code Smell Analyzer</h1>
            </div>
        </div>
    </nav>

    <!-- Upload Section -->
    <main class="container">
        <section class="upload-section" id="uploadSection">
            <div class="upload-card">
                <div class="upload-header">
                    <h2>Analyze Your Python Code</h2>
                    <p>Upload your Python file to detect code smells and get AI-powered suggestions</p>
                </div>

                <form id="uploadForm" action="/analyze" method="POST" enctype="multipart/form-data">
                    <div class="drop-zone" id="dropZone">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <h3>Drop your Python file here</h3>
                        <p>or</p>
                        <label for="fileInput" class="btn-browse">Browse Files</label>
                        <input type="file" id="fileInput" name="file" accept=".py" hidden>
                        <span class="file-info">Supports: .py files</span>
                    </div>
                    <div class="file-preview" id="filePreview" style="display: none;">
                        <div class="preview-content">
                            <svg class="file-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <div class="file-details">
                                <p class="file-name" id="fileName"></p>
                                <p class="file-size" id="fileSize"></p>
                            </div>
                            <button type="button" class="btn-remove" id="removeFile">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn-submit" id="submitBtn" disabled>
                        <span>Analyze Code</span>
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                        </svg>
                    </button>
                </form>

                <div class="loading" id="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Analyzing your code...</p>
                </div>
            </div>

            <div class="features">
                <div class="feature-card">
                    <div class="feature-icon">ðŸ¤–</div>
                    <h3>ML-Powered</h3>
                    <p>Multiple machine learning models for accurate detection</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <h3>Fast Analysis</h3>
                    <p>Get results in seconds with detailed insights</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ðŸ’¡</div>
                    <h3>Smart Fixes</h3>
                    <p>AI-generated suggestions to improve your code</p>
                </div>
            </div>

            <div class="model-accuracies-container" id="model-accuracies-container">
                <h3 class="accuracies-title">Trained Model Accuracies</h3>
                <div class="accuracies-grid" id="accuracies-grid">
                    <!-- Accuracies will be loaded here by JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const accuraciesGrid = document.getElementById('accuracies-grid');

            fetch('/api/model-accuracies')
                .then(response => response.json())
                .then(data => {
                    if (Object.keys(data).length === 0) {
                        accuraciesGrid.innerHTML = '<p>No accuracy data found. Please train the models first.</p>';
                        return;
                    }

                    for (const [model, accuracy] of Object.entries(data)) {
                        const card = document.createElement('div');
                        card.className = 'accuracy-card';

                        const modelName = document.createElement('div');
                        modelName.className = 'model-name';
                        modelName.textContent = model;

                        const accuracyInfo = document.createElement('div');
                        accuracyInfo.className = 'accuracy-info';

                        const accuracyBarContainer = document.createElement('div');
                        accuracyBarContainer.className = 'accuracy-bar-container';

                        const accuracyBar = document.createElement('div');
                        accuracyBar.className = 'accuracy-bar';
                        accuracyBar.style.width = `${accuracy}%`;

                        const accuracyText = document.createElement('span');
                        accuracyText.className = 'accuracy-text';
                        accuracyText.textContent = `${accuracy.toFixed(2)}%`;

                        accuracyBarContainer.appendChild(accuracyBar);
                        accuracyInfo.appendChild(accuracyBarContainer);
                        accuracyInfo.appendChild(accuracyText);

                        card.appendChild(modelName);
                        card.appendChild(accuracyInfo);

                        accuraciesGrid.appendChild(card);
                    }
                })
                .catch(error => {
                    console.error('Error fetching model accuracies:', error);
                    accuraciesGrid.innerHTML = '<p>Could not load model accuracies.</p>';
                });
        });
    </script>
</body>
</html>
